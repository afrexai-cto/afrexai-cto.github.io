<!DOCTYPE html>
<html lang="en">
<head>
    <meta property="og:image" content="https://afrexai-cto.github.io/assets/og-image.svg">n    <meta property="og:title" content="AfrexAI ‚Äî AI Agent Workforce">n    <meta property="og:description" content="Deploy AI agents that actually do the work. Not chatbots. Real agents.">n    <meta property="og:type" content="website">n    <meta name="twitter:card" content="summary_large_image">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AfrexAI Agent Workforce ‚Äî Live Demo</title>
<meta property="og:title" content="AfrexAI ‚Äî Interactive Demo">
<meta property="og:description" content="See AI agents working in real-time across healthcare, legal, and construction.">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0a;--surface:#111;--surface2:#1a1a1a;--surface3:#222;--gold:#FFD700;--gold-dim:#b89b00;--text:#e8e8e8;--text-dim:#888;--text-muted:#555;--green:#00e676;--red:#ff5252;--orange:#ffab40;--blue:#448aff;--radius:12px;--sidebar-w:220px}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
a{color:var(--gold);text-decoration:none}a:hover{text-decoration:underline}

/* ‚îÄ‚îÄ Company Selector ‚îÄ‚îÄ */
#selector{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px 100px;background:radial-gradient(ellipse at 50% 0%,#1a1400 0%,var(--bg) 70%)}
.selector-header{text-align:center;margin-bottom:40px}
.selector-header .logo{font-size:32px;font-weight:700;color:var(--gold);letter-spacing:1px}
.selector-header .subtitle{color:var(--text-dim);font-size:15px;margin-top:6px}
.selector-header .managed-badge{display:inline-block;margin-top:12px;padding:6px 16px;border-radius:20px;font-size:12px;background:#FFD70012;border:1px solid #FFD70033;color:var(--gold);letter-spacing:.5px}
.selector-prompt{color:var(--text-dim);font-size:14px;margin-bottom:24px;text-align:center}
.company-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;max-width:900px;width:100%}
.company-card{background:var(--surface);border:1px solid var(--surface3);border-radius:var(--radius);padding:28px 24px;cursor:pointer;transition:all .2s;text-align:center}
.company-card:hover{border-color:var(--gold);box-shadow:0 0 20px rgba(255,215,0,.12);transform:translateY(-2px)}
.company-card .cc-icon{font-size:40px;margin-bottom:12px}
.company-card .cc-name{font-size:17px;font-weight:700;margin-bottom:6px}
.company-card .cc-pills{display:flex;gap:6px;justify-content:center;margin-bottom:10px;flex-wrap:wrap}
.pill{font-size:11px;padding:3px 10px;border-radius:20px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap}
.pill-vertical{background:#448aff18;color:var(--blue);border:1px solid #448aff33}
.pill-tier{background:#FFD70012;color:var(--gold);border:1px solid #FFD70033}
.company-card .cc-agents{font-size:12px;color:var(--text-dim);margin-bottom:6px}
.company-card .cc-tagline{font-size:13px;color:var(--text-dim);line-height:1.4;margin-bottom:16px}
.cc-btn{display:inline-block;padding:10px 24px;background:var(--gold);color:#000;font-weight:600;border-radius:8px;font-size:14px;border:none;cursor:pointer;transition:background .2s}
.cc-btn:hover{background:#e6c200}
.selector-footer{margin-top:32px;font-size:12px;color:var(--text-muted);text-align:center}

/* ‚îÄ‚îÄ App Shell ‚îÄ‚îÄ */
#app{display:none;min-height:100vh}
#app.visible{display:flex;flex-direction:column}

/* ‚îÄ‚îÄ Top Header ‚îÄ‚îÄ */
.top-header{display:flex;align-items:center;gap:16px;padding:14px 24px;background:var(--surface);border-bottom:1px solid var(--surface3);position:sticky;top:0;z-index:30;flex-wrap:wrap}
.top-header .logo{font-size:20px;font-weight:700;color:var(--gold);letter-spacing:1px;white-space:nowrap}
.top-header .divider{width:1px;height:24px;background:var(--surface3)}
.top-header .co-name{font-size:15px;font-weight:600;white-space:nowrap}
.top-header .co-pills{display:flex;gap:6px}
.managed-tag{font-size:10px;padding:3px 8px;border-radius:10px;background:#FFD70012;color:var(--gold-dim);border:1px solid #FFD70033;white-space:nowrap}
.switch-btn{margin-left:auto;padding:8px 16px;border:1px solid var(--surface3);border-radius:8px;background:none;color:var(--text-dim);font-size:13px;cursor:pointer;font-family:inherit;transition:all .15s;white-space:nowrap}
.switch-btn:hover{border-color:var(--gold);color:var(--gold)}

/* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
.app-body{display:flex;flex:1}
.sidebar{width:var(--sidebar-w);background:var(--surface);border-right:1px solid var(--surface3);padding:16px 12px;display:flex;flex-direction:column;gap:4px;position:sticky;top:56px;height:calc(100vh - 56px);flex-shrink:0}
.nav-link{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:8px;font-size:14px;color:var(--text-dim);cursor:pointer;border:none;background:none;width:100%;text-align:left;font-family:inherit;transition:all .15s}
.nav-link:hover{background:var(--surface2);color:var(--text)}
.nav-link.active{background:var(--surface2);color:var(--gold);font-weight:600}
.nav-link .ni{font-size:18px;width:24px;text-align:center;flex-shrink:0}
.main-content{flex:1;min-width:0;padding:24px 32px 100px}

/* ‚îÄ‚îÄ Shared ‚îÄ‚îÄ */
.section{margin-bottom:28px}
.section-title{font-size:12px;text-transform:uppercase;letter-spacing:2px;color:var(--gold);margin-bottom:14px;font-weight:600}
.card{background:var(--surface);border:1px solid var(--surface3);border-radius:var(--radius);padding:24px;transition:border .2s}
.card:hover{border-color:#333}

/* ‚îÄ‚îÄ Metrics ‚îÄ‚îÄ */
.metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
.metric-card{background:var(--surface);border:1px solid var(--surface3);border-radius:var(--radius);padding:20px;text-align:center}
.metric-card .value{font-size:28px;font-weight:700;color:var(--gold);line-height:1}
.metric-card .label{font-size:11px;color:var(--text-dim);margin-top:6px;text-transform:uppercase;letter-spacing:1px}
.metric-card .sub{font-size:11px;color:var(--text-muted);margin-top:4px}

/* ‚îÄ‚îÄ Agent Grid ‚îÄ‚îÄ */
.agents-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px}
.agent-card{display:flex;gap:14px;align-items:flex-start;cursor:pointer;transition:border-color .2s}
.agent-card:hover{border-color:var(--gold)}
.agent-avatar{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;background:var(--surface2)}
.agent-info{flex:1;min-width:0}
.agent-name{font-weight:600;font-size:15px}
.agent-role{font-size:12px;color:var(--text-dim);margin-top:2px}
.agent-meta{display:flex;gap:12px;margin-top:8px;flex-wrap:wrap}
.agent-meta span{font-size:12px;color:var(--text-dim)}
.agent-meta strong{color:var(--text)}

/* ‚îÄ‚îÄ Status ‚îÄ‚îÄ */
.status-dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:4px;vertical-align:middle}
.status-dot.active{background:var(--green);animation:pulse 2s infinite}
.status-dot.processing{background:var(--gold);animation:pulse 1.5s infinite}
.status-dot.idle{background:var(--text-muted)}
.badge{font-size:11px;padding:3px 10px;border-radius:20px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap;display:inline-block}

/* ‚îÄ‚îÄ Activity Feed ‚îÄ‚îÄ */
.feed{max-height:420px;overflow-y:auto;padding:4px 0}
.feed-item{display:flex;gap:12px;padding:10px 16px;border-bottom:1px solid var(--surface2);align-items:flex-start;animation:slideIn .3s ease}
.feed-item:last-child{border-bottom:none}
.feed-time{font-size:11px;color:var(--text-muted);font-family:monospace;white-space:nowrap;min-width:64px;margin-top:2px}
.feed-agent{font-size:13px;color:var(--gold);font-weight:600;white-space:nowrap}
.feed-text{font-size:13px;color:var(--text-dim);line-height:1.4}
.feed-icon{font-size:14px;margin-top:2px}

/* ‚îÄ‚îÄ Agent Detail Panel ‚îÄ‚îÄ */
.detail-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:40;display:none;opacity:0;transition:opacity .25s}
.detail-overlay.visible{display:block;opacity:1}
.detail-panel{position:fixed;top:0;right:0;bottom:0;width:420px;max-width:100vw;background:var(--surface);border-left:1px solid var(--surface3);z-index:41;display:none;transform:translateX(100%);transition:transform .3s ease;overflow-y:auto;padding:24px}
.detail-panel.visible{display:block;transform:translateX(0)}
.detail-close{position:absolute;top:16px;right:16px;background:none;border:none;color:var(--text-dim);font-size:24px;cursor:pointer;padding:4px 8px;line-height:1}
.detail-close:hover{color:var(--text)}
.detail-header{display:flex;align-items:center;gap:14px;margin-bottom:24px}
.detail-header .da{font-size:32px}
.detail-header h2{font-size:20px;font-weight:700}
.detail-stats{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:24px}
.detail-stat{background:var(--surface2);border-radius:8px;padding:14px;text-align:center}
.detail-stat .ds-val{font-size:20px;font-weight:700;color:var(--gold)}
.detail-stat .ds-lbl{font-size:11px;color:var(--text-dim);margin-top:4px;text-transform:uppercase}
.capacity-bar{height:8px;border-radius:4px;background:var(--surface3);overflow:hidden;margin-top:8px}
.capacity-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--gold),var(--green));transition:width .6s}
.detail-log{margin-top:20px;max-height:350px;overflow-y:auto}
.detail-log .dl-item{padding:8px 0;border-bottom:1px solid var(--surface2);font-size:13px;color:var(--text-dim)}
.detail-log .dl-item .dl-time{color:var(--text-muted);font-family:monospace;margin-right:8px;font-size:11px}

/* ‚îÄ‚îÄ ROI View ‚îÄ‚îÄ */
.roi-box{background:linear-gradient(135deg,#1a1400,var(--surface));border:1px solid #333;border-radius:var(--radius);padding:28px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:20px;margin-bottom:24px}
.roi-value{font-size:42px;font-weight:700;color:var(--gold);line-height:1}
.roi-label{font-size:12px;color:var(--text-dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.roi-sub{font-size:14px;color:var(--text-dim);margin-top:4px}
.cost-compare{display:flex;gap:20px;margin-bottom:24px;flex-wrap:wrap}
.cost-bar-wrap{flex:1;min-width:200px}
.cost-bar-label{font-size:13px;color:var(--text-dim);margin-bottom:6px}
.cost-bar-track{height:32px;border-radius:6px;background:var(--surface3);overflow:hidden;position:relative}
.cost-bar-fill{height:100%;border-radius:6px;display:flex;align-items:center;padding:0 12px;font-size:13px;font-weight:600;color:#000;transition:width .8s}
.fte-note{font-size:14px;color:var(--text-dim);margin-bottom:24px;padding:16px;background:var(--surface);border-radius:var(--radius);border:1px solid var(--surface3)}
.fte-note strong{color:var(--gold)}

/* ‚îÄ‚îÄ Before/After ‚îÄ‚îÄ */
.ba-table{width:100%;border-collapse:collapse;font-size:13px}
.ba-table th{text-align:left;padding:10px 14px;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim);border-bottom:1px solid var(--surface3)}
.ba-table td{padding:10px 14px;border-bottom:1px solid var(--surface2)}
.ba-table .ba-before{background:#ff525208}
.ba-table .ba-after{background:#00e67608}
.ba-table .ba-task{font-weight:600;color:var(--text)}
.ba-table .ba-bad{color:var(--red)}
.ba-table .ba-good{color:var(--green)}
.upgrade-cta{margin-top:24px;padding:20px;background:linear-gradient(135deg,#1a1400,var(--surface));border:1px solid #333;border-radius:var(--radius);text-align:center}
.upgrade-cta h3{color:var(--gold);margin-bottom:8px}
.upgrade-cta p{font-size:14px;color:var(--text-dim);margin-bottom:16px}

/* ‚îÄ‚îÄ Real Artifact Feed Items ‚îÄ‚îÄ */
.feed-item.feed-item-real{border-left:3px solid var(--gold);background:#FFD70006}
.ai-badge{display:inline-block;font-size:10px;padding:2px 8px;border-radius:10px;background:#FFD70018;color:var(--gold);border:1px solid #FFD70033;font-weight:600;letter-spacing:.3px;margin-left:6px;vertical-align:middle}
.view-output-link{font-size:12px;color:var(--gold);cursor:pointer;margin-left:8px;font-weight:600;transition:color .15s}
.view-output-link:hover{color:#fff;text-decoration:underline}

/* ‚îÄ‚îÄ Artifact Modal ‚îÄ‚îÄ */
.artifact-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:60;display:none;opacity:0;transition:opacity .3s;justify-content:center;align-items:center}
.artifact-overlay.visible{display:flex;opacity:1}
.artifact-modal{background:var(--surface);border:1px solid var(--surface3);border-radius:var(--radius);max-width:720px;width:92%;max-height:85vh;display:flex;flex-direction:column;animation:modalIn .3s ease}
@keyframes modalIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.artifact-modal-header{display:flex;align-items:center;gap:12px;padding:18px 24px;border-bottom:1px solid var(--surface3);flex-wrap:wrap}
.artifact-modal-header .amh-icon{font-size:24px}
.artifact-modal-header .amh-info{flex:1;min-width:0}
.artifact-modal-header .amh-agent{font-weight:700;font-size:15px}
.artifact-modal-header .amh-meta{font-size:12px;color:var(--text-dim);margin-top:2px}
.artifact-modal-close{background:none;border:none;color:var(--text-dim);font-size:24px;cursor:pointer;padding:4px 8px;line-height:1}
.artifact-modal-close:hover{color:var(--text)}
.artifact-modal-body{padding:24px;overflow-y:auto;flex:1;font-size:14px;line-height:1.7;color:var(--text)}
.artifact-modal-body h1{font-size:22px;color:var(--gold);margin:20px 0 10px;font-weight:700}
.artifact-modal-body h2{font-size:18px;color:var(--gold);margin:18px 0 8px;font-weight:700}
.artifact-modal-body h3{font-size:15px;color:var(--text);margin:14px 0 6px;font-weight:700}
.artifact-modal-body p{margin:8px 0}
.artifact-modal-body ul,.artifact-modal-body ol{margin:8px 0 8px 20px}
.artifact-modal-body li{margin:4px 0}
.artifact-modal-body strong{color:var(--gold)}
.artifact-modal-body em{color:var(--text-dim);font-style:italic}
.artifact-modal-body hr{border:none;border-top:1px solid var(--surface3);margin:16px 0}
.artifact-modal-footer{padding:12px 24px;border-top:1px solid var(--surface3);font-size:11px;color:var(--text-muted);text-align:center}
.artifact-spinner{text-align:center;padding:40px;color:var(--text-dim);font-size:14px}

/* ‚îÄ‚îÄ Deliverables Banner ‚îÄ‚îÄ */
.deliverables-banner{margin-bottom:28px}
.deliverables-banner .section-title{margin-bottom:14px}
.deliv-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
.deliv-card{background:var(--surface);border:1px solid var(--surface3);border-radius:var(--radius);padding:18px;border-left:3px solid var(--gold);cursor:pointer;transition:border-color .2s}
.deliv-card:hover{border-color:var(--gold)}
.deliv-card .dc-top{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.deliv-card .dc-icon{font-size:20px}
.deliv-card .dc-agent{font-size:13px;font-weight:600;color:var(--gold)}
.deliv-card .dc-title{font-size:13px;color:var(--text);line-height:1.4;margin-bottom:6px}
.deliv-card .dc-time{font-size:11px;color:var(--text-muted)}
.deliv-card .dc-link{font-size:12px;color:var(--gold);font-weight:600;margin-top:8px;display:inline-block}

/* ‚îÄ‚îÄ Detail Panel Deliverables ‚îÄ‚îÄ */
.detail-deliverables{margin-top:20px}
.detail-deliverables .dd-title{font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);margin-bottom:10px;font-weight:600}
.dd-item{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--surface2);font-size:13px}
.dd-item:last-child{border-bottom:none}
.dd-item .dd-text{flex:1;color:var(--text-dim)}
.dd-item .dd-time{font-size:11px;color:var(--text-muted);font-family:monospace}
.dd-item .dd-view{font-size:12px;color:var(--gold);cursor:pointer;font-weight:600;background:none;border:none;font-family:inherit}
.dd-item .dd-view:hover{color:#fff}
.dd-empty{font-size:13px;color:var(--text-muted);font-style:italic;padding:10px 0}

/* ‚îÄ‚îÄ CTA Bar ‚îÄ‚îÄ */
.cta-bar{position:fixed;bottom:0;left:0;right:0;z-index:50;padding:14px 24px;display:flex;align-items:center;justify-content:center;gap:16px;background:rgba(10,10,10,.92);backdrop-filter:blur(12px);border-top:1px solid #FFD70033}
.cta-bar .cta-text{font-size:14px;color:var(--text-dim)}
.cta-btn{display:inline-block;padding:12px 28px;background:var(--gold);color:#000;font-weight:600;border-radius:8px;font-size:14px;border:none;cursor:pointer;transition:all .2s;text-decoration:none}
.cta-btn:hover{background:#e6c200;box-shadow:0 0 20px rgba(255,215,0,.25);text-decoration:none}

/* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
@keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes countUp{from{opacity:.5}to{opacity:1}}

/* ‚îÄ‚îÄ Views ‚îÄ‚îÄ */
.view{display:none}.view.active{display:block}

/* ‚îÄ‚îÄ Mobile ‚îÄ‚îÄ */
.bottom-nav{display:none;position:fixed;bottom:60px;left:0;right:0;background:var(--surface);border-top:1px solid var(--surface3);z-index:25;justify-content:space-around;padding:8px 0 max(8px,env(safe-area-inset-bottom))}
.bottom-nav button{background:none;border:none;color:var(--text-dim);font-size:10px;display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;padding:4px 8px;font-family:inherit}
.bottom-nav button .bni{font-size:20px}
.bottom-nav button.active{color:var(--gold)}

@media(max-width:768px){
  .company-cards{grid-template-columns:1fr}
  .sidebar{display:none}
  .bottom-nav{display:flex}
  .main-content{padding:16px 14px 140px}
  .metrics{grid-template-columns:1fr 1fr}
  .metric-card .value{font-size:22px}
  .roi-value{font-size:32px}
  .detail-panel{width:100vw}
  .top-header{padding:12px 14px;gap:10px}
  .top-header .divider,.managed-tag{display:none}
  .agents-grid{grid-template-columns:1fr}
  .cost-compare{flex-direction:column}
}
@media(min-width:769px) and (max-width:1024px){
  .metrics{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>

<!-- Top Nav -->
<nav style="position:fixed;top:0;left:0;right:0;height:44px;background:rgba(17,17,17,.92);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-bottom:1px solid #222;display:flex;align-items:center;justify-content:space-between;padding:0 1.5rem;z-index:9999">
  <a href="landing" style="color:#FFD700;font-weight:700;font-size:14px;text-decoration:none;letter-spacing:.5px">AfrexAI Demo</a>
  <div style="display:flex;gap:4px;align-items:center">
    <a href="./" style="color:#FFD700;font-size:12px;text-decoration:none;padding:6px 12px;border-radius:6px;font-weight:600">Managed</a>
    <a href="cma" style="color:#999;font-size:12px;text-decoration:none;padding:6px 12px;border-radius:6px">Self-Managed</a>
    <a href="how-it-works" style="color:#999;font-size:12px;text-decoration:none;padding:6px 12px;border-radius:6px">How It Works</a>
    <a href="agency" style="color:#999;font-size:12px;text-decoration:none;padding:6px 12px;border-radius:6px">For Agencies</a>
    <a href="https://calendly.com/cbeckford-afrexai/30min" style="color:#0a0a0a;background:#FFD700;font-weight:600;font-size:12px;padding:5px 12px;border-radius:6px;text-decoration:none">Book a Call</a>
  </div>
</nav>
<div style="height:44px"></div>

<!-- ‚ïê‚ïê‚ïê Company Selector ‚ïê‚ïê‚ïê -->
<div id="selector">
  <div class="selector-header">
    <div class="logo">AfrexAI</div>
    <div class="subtitle">Agent Workforce ‚Äî Live Demo</div>
    <div class="managed-badge">üîß Fully Managed by AfrexAI</div>
  </div>
  <div class="selector-prompt">Select a company to explore their AI agent workforce in action</div>
  <div class="company-cards" id="company-cards"></div>
  <div class="selector-footer">These are simulated deployments using real AfrexAI agent configurations</div>
</div>

<!-- ‚ïê‚ïê‚ïê App Shell ‚ïê‚ïê‚ïê -->
<div id="app">
  <div class="top-header">
    <span class="logo">AfrexAI</span>
    <span class="divider"></span>
    <span class="co-name" id="hdr-company"></span>
    <span class="co-pills" id="hdr-pills"></span>
    <span class="managed-tag">üîß Managed</span>
    <span id="live-badge" style="font-size:11px;padding:4px 10px;border-radius:12px;background:var(--surface2);border:1px solid var(--surface3);color:var(--text-muted)">üî¥ Simulated</span>
    <button class="switch-btn" id="switch-btn">‚Üê Switch Company</button>
  </div>
  <div class="app-body">
    <nav class="sidebar" id="sidebar">
      <button class="nav-link active" data-view="dashboard"><span class="ni">üìä</span>Dashboard</button>
      <button class="nav-link" data-view="agents"><span class="ni">ü§ñ</span>Agents</button>
      <button class="nav-link" data-view="roi"><span class="ni">üí∞</span>ROI & Before/After</button>
    </nav>
    <div class="main-content">
      <!-- Dashboard -->
      <div class="view active" id="view-dashboard">
        <div class="section"><div class="section-title">Key Metrics</div><div class="metrics" id="kpi-grid"></div></div>
        <div class="deliverables-banner" id="deliverables-banner" style="display:none"><div class="section-title">üìã Latest Agent Deliverables</div><div class="deliv-cards" id="deliv-cards"></div></div>
        <div class="section"><div class="section-title">Agent Status</div><div class="agents-grid" id="agent-grid"></div></div>
        <div class="section"><div class="section-title">Live Activity Feed</div><div class="card" style="padding:0"><div class="feed" id="activity-feed" aria-live="polite"></div></div></div>
      </div>
      <!-- Agents -->
      <div class="view" id="view-agents">
        <div class="section"><div class="section-title">Agent Workforce</div><div class="agents-grid" id="agents-list"></div></div>
      </div>
      <!-- ROI -->
      <div class="view" id="view-roi">
        <div class="section"><div class="section-title">Return on Investment</div><div id="roi-content"></div></div>
        <div class="section"><div class="section-title">Before &amp; After AfrexAI</div><div class="card" style="padding:0;overflow-x:auto" id="ba-content"></div></div>
        <div id="upgrade-content"></div>
      </div>
    </div>
  </div>
  <!-- Bottom Nav (mobile) -->
  <div class="bottom-nav" id="bottom-nav">
    <button data-view="dashboard" class="active"><span class="bni">üìä</span>Dashboard</button>
    <button data-view="agents"><span class="bni">ü§ñ</span>Agents</button>
    <button data-view="roi"><span class="bni">üí∞</span>ROI</button>
  </div>
</div>

<!-- Agent Detail Panel -->
<div class="detail-overlay" id="detail-overlay"></div>
<div class="detail-panel" id="detail-panel">
  <button class="detail-close" id="detail-close">√ó</button>
  <div id="detail-body"></div>
</div>

<!-- Artifact Viewer Modal -->
<div class="artifact-overlay" id="artifact-overlay">
  <div class="artifact-modal">
    <div class="artifact-modal-header">
      <span class="amh-icon" id="artifact-icon"></span>
      <div class="amh-info">
        <div class="amh-agent" id="artifact-agent"></div>
        <div class="amh-meta" id="artifact-meta"></div>
      </div>
      <span class="ai-badge">‚ú¶ Generated by AI Agent</span>
      <button class="artifact-modal-close" id="artifact-close">√ó</button>
    </div>
    <div class="artifact-modal-body" id="artifact-body">
      <div class="artifact-spinner">‚è≥ Loading deliverable...</div>
    </div>
    <div class="artifact-modal-footer">This is a real deliverable produced by an AI agent processing actual data</div>
  </div>
</div>

<!-- CTA Bar -->
<div class="cta-bar">
  <span class="cta-text">Ready to deploy your own AI agents?</span>
  <a href="https://calendly.com/cbeckford-afrexai/30min" target="_blank" class="cta-btn">Book a Call ‚Üí</a>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AfrexAI Interactive Demo ‚Äî SPA
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

// ‚îÄ‚îÄ Fill-in data ‚îÄ‚îÄ
const FILL = {
  patient:["Maria Santos","James Chen","Aisha Patel","Robert Kim","Diana Moss","Carlos Rivera","Priya Sharma","Thomas Walker"],
  specialty:["Cardiology","Orthopedics","Internal Medicine","Dermatology","Neurology","Pediatrics"],
  doctor:["Chen","Patel","Williams","Nakamura","Okafor"],
  staff:["Dr. Chen","Nurse Williams","Tech Santos","Admin Patel"],
  vendor:["LabCorp","Quest Diagnostics","Medline","McKesson"],
  department:["Cardiology","Radiology","ER","Admin"],
  facility:["St. Mary's Hospital","Regional Medical Center","University Health"],
  date1:["Monday 2pm","Tuesday 10am","Wednesday 3pm"],
  date2:["Thursday 11am","Friday 9am","Monday 4pm"],
  client:["Westfield Corp","Dynamo LLC","Chen Family Trust","Greenleaf Holdings","Rivera Properties"],
  case:["Westfield v. Pacific","Dynamo IP Dispute","Chen Estate Matter","Greenleaf Zoning Appeal"],
  attorney:["Sarah Kim","David Torres","Rachel O'Brien","Marcus Webb"],
  court:["SF Superior Court","9th Circuit","Federal District Court"],
  deadline:["Motion to Compel (3/15)","Discovery deadline (3/22)","Filing deadline (4/01)"],
  document:["NDA","MSA","Settlement Agreement","Licensing Agreement"],
  pages:["12","24","38","47","8"],
  prospect:["new referral M. Johnson","initial consult T. Park","inquiry from Westgate Inc"],
  site:["Riverside Office Complex","Marina Heights Phase 2","Downtown Parking Structure","Eastgate Retail Center"],
  weather:["heavy rain","high winds","extreme heat advisory","fog delay"],
  milestone:["Foundation complete","Steel framing 80%","Electrical rough-in","HVAC install started","Final inspection prep"],
  days:["2","3","5","1","4"]
};
function pick(arr){return arr[Math.floor(Math.random()*arr.length)]}
function fillTemplate(t){return t.replace(/\{(\w+)\}/g,(_,k)=>FILL[k]?pick(FILL[k]):k)}
function fmt$(n){return '$'+Number(n).toLocaleString('en-US')}
function fmtNum(n){return Number(n).toLocaleString('en-US')}
function pad(n){return String(n).padStart(2,'0')}
function timeStr(d){return pad(d.getHours())+':'+pad(d.getMinutes())+':'+pad(d.getSeconds())}

// ‚îÄ‚îÄ Data ‚îÄ‚îÄ
const DEMO_DATA={companies:[
{id:"meridian-health",name:"Meridian Health Partners",vertical:"Healthcare",tier:"Enterprise",monthlyPrice:13200,logo:"üè•",
tagline:"Multi-location medical practice ‚Äî 45 staff",deployedSince:"2025-11-12",
agents:[
{id:"patient-coordinator",name:"Patient Coordinator",description:"Manages appointment scheduling, referrals, patient communications, and intake workflows",status:"active",statusText:"Scheduling appointment",icon:"üìã",tasksCompleted:1243,tasksToday:47,avgTaskTime:"2.1 min",hoursSavedMonth:142,uptime:99.98,capacity:74,
taskLog:[{time:"14:32",task:"Scheduled follow-up for Maria Santos ‚Äî Cardiology"},{time:"14:28",task:"Sent appointment reminder batch (23 patients)"},{time:"14:21",task:"Processed referral from Dr. Chen ‚Üí Orthopedics"},{time:"14:15",task:"Updated intake forms for new patient James Chen"},{time:"14:08",task:"Confirmed insurance eligibility for Aisha Patel"},{time:"13:55",task:"Rescheduled Robert Kim from Monday 2pm to Thursday 11am"},{time:"13:42",task:"Sent appointment reminder to Diana Moss"},{time:"13:30",task:"Processed referral from Dr. Patel ‚Üí Neurology"},{time:"13:18",task:"Scheduled follow-up for Carlos Rivera ‚Äî Dermatology"},{time:"13:05",task:"Updated intake forms for new patient Priya Sharma"}]},
{id:"compliance-officer",name:"Compliance Officer",description:"Monitors HIPAA compliance, manages audit trails, tracks training, and flags policy violations",status:"active",statusText:"Reviewing access logs",icon:"üõ°Ô∏è",tasksCompleted:876,tasksToday:28,avgTaskTime:"3.4 min",hoursSavedMonth:98,uptime:99.99,capacity:62,
taskLog:[{time:"14:30",task:"Completed HIPAA training verification ‚Äî Dr. Chen"},{time:"14:22",task:"Verified access log audit ‚Äî Radiology"},{time:"14:10",task:"Updated privacy policy documentation"},{time:"13:58",task:"Flagged expired BAA with LabCorp"},{time:"13:45",task:"Generated monthly compliance report"},{time:"13:32",task:"Verified access log audit ‚Äî ER"},{time:"13:20",task:"Completed HIPAA training verification ‚Äî Nurse Williams"},{time:"13:08",task:"Updated risk assessment matrix"},{time:"12:55",task:"Reviewed vendor security questionnaire ‚Äî McKesson"},{time:"12:40",task:"Archived Q3 audit documentation"}]},
{id:"records-analyst",name:"Records Analyst",description:"Processes medical records requests, manages chart completeness, and handles secure transfers",status:"processing",statusText:"Processing records batch",icon:"üìÅ",tasksCompleted:728,tasksToday:19,avgTaskTime:"4.8 min",hoursSavedMonth:72,uptime:99.95,capacity:81,
taskLog:[{time:"14:29",task:"Processed medical records request ‚Äî Aisha Patel"},{time:"14:18",task:"Sent records to St. Mary's Hospital via secure transfer"},{time:"14:05",task:"Flagged incomplete chart for Dr. Williams"},{time:"13:50",task:"Archived 34 inactive patient records"},{time:"13:38",task:"Completed chart deficiency review ‚Äî Cardiology"},{time:"13:25",task:"Processed medical records request ‚Äî Thomas Walker"},{time:"13:12",task:"Sent records to Regional Medical Center via secure transfer"},{time:"12:58",task:"Flagged incomplete chart for Dr. Nakamura"},{time:"12:45",task:"Completed chart deficiency review ‚Äî Admin"},{time:"12:30",task:"Archived 18 inactive patient records"}]}
],
activities:[
{agent:"patient-coordinator",templates:["Scheduled appointment for {patient} ‚Äî {specialty}","Sent appointment reminder to {patient}","Processed referral from Dr. {doctor} ‚Üí {specialty}","Updated intake forms for new patient {patient}","Rescheduled {patient} from {date1} to {date2}","Confirmed insurance eligibility for {patient}"]},
{agent:"compliance-officer",templates:["Completed HIPAA training verification ‚Äî {staff}","Flagged expired BAA with {vendor}","Generated monthly compliance report","Verified access log audit ‚Äî {department}","Updated privacy policy documentation"]},
{agent:"records-analyst",templates:["Processed medical records request ‚Äî {patient}","Flagged incomplete chart for Dr. {doctor}","Archived 34 inactive patient records","Sent records to {facility} via secure transfer","Completed chart deficiency review ‚Äî {department}"]}
],
kpis:{tasksThisMonth:2847,hoursSaved:312,costSavings:18720,avgResponseTime:"2.4 min",uptime:99.97},
beforeAfter:{before:[{task:"Patient scheduling",time:"45 min/patient",errors:"12% double-bookings"},{task:"HIPAA audit prep",time:"3 weeks",errors:"Manual checklist gaps"},{task:"Records requests",time:"48hr turnaround",errors:"22% incomplete"},{task:"Referral follow-up",time:"Often forgotten",errors:"35% drop-off"}],
after:[{task:"Patient scheduling",time:"3 min/patient",savings:"93% faster"},{task:"HIPAA audit prep",time:"Always current",savings:"Continuous monitoring"},{task:"Records requests",time:"4hr turnaround",savings:"92% faster"},{task:"Referral follow-up",time:"Same-day",savings:"98% completion"}]}
},
{id:"pacific-legal",name:"Pacific Legal Group",vertical:"Legal Services",tier:"Growth",monthlyPrice:4950,logo:"‚öñÔ∏è",
tagline:"Boutique litigation firm ‚Äî 12 attorneys",deployedSince:"2025-12-03",
agents:[
{id:"legal-ea",name:"Legal Executive Assistant",description:"Manages calendars, deadlines, court filings, and daily administrative workflow",status:"active",statusText:"Calendaring deadline",icon:"üìÖ",tasksCompleted:891,tasksToday:31,avgTaskTime:"1.8 min",hoursSavedMonth:96,uptime:99.99,capacity:68,
taskLog:[{time:"14:31",task:"Filed motion in Westfield v. Pacific"},{time:"14:25",task:"Calendared deadline: Motion to Compel (3/15)"},{time:"14:18",task:"Prepared conference agenda for Sarah Kim"},{time:"14:10",task:"Sent court appearance reminder ‚Äî SF Superior Court"},{time:"14:02",task:"Filed motion in Dynamo IP Dispute"},{time:"13:48",task:"Calendared deadline: Discovery deadline (3/22)"},{time:"13:35",task:"Prepared conference agenda for David Torres"},{time:"13:22",task:"Sent court appearance reminder ‚Äî Federal District Court"},{time:"13:10",task:"Updated matter calendar for Chen Estate Matter"},{time:"12:55",task:"Sent court appearance reminder ‚Äî 9th Circuit"}]},
{id:"document-analyst",name:"Document Analyst",description:"Reviews, summarises, and flags issues in contracts, briefs, and legal documents",status:"processing",statusText:"Reviewing contract",icon:"üìÑ",tasksCompleted:634,tasksToday:18,avgTaskTime:"4.2 min",hoursSavedMonth:87,uptime:99.95,capacity:83,
taskLog:[{time:"14:28",task:"Reviewed contract for Westfield Corp (24 pages)"},{time:"14:15",task:"Flagged non-standard clause in NDA"},{time:"14:02",task:"Summarised deposition transcript ‚Äî Dynamo IP Dispute"},{time:"13:48",task:"Reviewed contract for Greenleaf Holdings (38 pages)"},{time:"13:32",task:"Flagged non-standard clause in MSA"},{time:"13:18",task:"Summarised deposition transcript ‚Äî Chen Estate Matter"},{time:"13:05",task:"Reviewed contract for Chen Family Trust (12 pages)"},{time:"12:50",task:"Flagged non-standard clause in Settlement Agreement"},{time:"12:38",task:"Cross-referenced precedent in Greenleaf Zoning Appeal"},{time:"12:22",task:"Generated clause comparison report"}]},
{id:"client-followup",name:"Client Follow-up Coordinator",description:"Tracks client communications, sends follow-ups, and ensures nothing falls through",status:"active",statusText:"Sending case update",icon:"üìû",tasksCompleted:512,tasksToday:22,avgTaskTime:"1.4 min",hoursSavedMonth:54,uptime:99.97,capacity:58,
taskLog:[{time:"14:30",task:"Sent case status update to Westfield Corp"},{time:"14:22",task:"Scheduled consultation with new referral M. Johnson"},{time:"14:14",task:"Followed up on outstanding invoice ‚Äî Dynamo LLC"},{time:"14:05",task:"Sent case status update to Chen Family Trust"},{time:"13:52",task:"Scheduled consultation with initial consult T. Park"},{time:"13:40",task:"Followed up on outstanding invoice ‚Äî Greenleaf Holdings"},{time:"13:28",task:"Sent case status update to Rivera Properties"},{time:"13:15",task:"Scheduled consultation with inquiry from Westgate Inc"},{time:"13:02",task:"Sent 30-day check-in to Westfield Corp"},{time:"12:48",task:"Updated client contact records"}]}
],
activities:[
{agent:"legal-ea",templates:["Filed motion in {case}","Calendared deadline: {deadline}","Prepared conference agenda for {attorney}","Sent court appearance reminder ‚Äî {court}"]},
{agent:"document-analyst",templates:["Reviewed contract for {client} ({pages} pages)","Flagged non-standard clause in {document}","Summarised deposition transcript ‚Äî {case}","Generated clause comparison report"]},
{agent:"client-followup",templates:["Sent case status update to {client}","Scheduled consultation with {prospect}","Followed up on outstanding invoice ‚Äî {client}","Sent 30-day check-in to {client}"]}
],
kpis:{tasksThisMonth:2037,hoursSaved:237,costSavings:23700,avgResponseTime:"1.8 min",uptime:99.97},
beforeAfter:{before:[{task:"Court filing tracking",time:"Manual calendar checks",errors:"8% missed deadlines"},{task:"Contract review",time:"4-6 hours per contract",errors:"Key clauses missed"},{task:"Client follow-up",time:"Sporadic, often late",errors:"23% complaints about communication"},{task:"Deadline management",time:"Spreadsheet-based",errors:"Critical dates slip"}],
after:[{task:"Court filing tracking",time:"Automated alerts",savings:"Zero missed deadlines"},{task:"Contract review",time:"45 min flagged summary",savings:"85% faster"},{task:"Client follow-up",time:"Same-day automated",savings:"97% satisfaction rate"},{task:"Deadline management",time:"Real-time monitoring",savings:"100% on-time"}]}
},
{id:"buildright",name:"BuildRight Construction",vertical:"Construction",tier:"Starter",monthlyPrice:5500,logo:"üèóÔ∏è",
tagline:"Commercial contractor ‚Äî 28 crew, 4 active sites",deployedSince:"2026-01-08",
agents:[
{id:"site-reporter",name:"Site Reporter",description:"Compiles daily site reports, logs progress photos, tracks weather delays and milestones",status:"active",statusText:"Generating daily report",icon:"üìä",tasksCompleted:423,tasksToday:14,avgTaskTime:"3.5 min",hoursSavedMonth:67,uptime:99.92,capacity:71,
taskLog:[{time:"14:30",task:"Generated daily report ‚Äî Riverside Office Complex"},{time:"14:18",task:"Logged weather delay at Marina Heights Phase 2: heavy rain"},{time:"14:05",task:"Updated milestone: Foundation complete at Eastgate Retail Center"},{time:"13:50",task:"Compiled weekly progress summary"},{time:"13:38",task:"Flagged schedule variance ‚Äî Downtown Parking Structure (3 days behind)"},{time:"13:22",task:"Generated daily report ‚Äî Marina Heights Phase 2"},{time:"13:10",task:"Updated milestone: Steel framing 80% at Riverside Office Complex"},{time:"12:55",task:"Logged weather delay at Eastgate Retail Center: high winds"},{time:"12:40",task:"Generated daily report ‚Äî Downtown Parking Structure"},{time:"12:28",task:"Compiled photo log ‚Äî Riverside Office Complex"}]}
],
activities:[
{agent:"site-reporter",templates:["Generated daily report ‚Äî {site}","Logged weather delay at {site}: {weather}","Updated milestone: {milestone} at {site}","Compiled weekly progress summary","Flagged schedule variance ‚Äî {site} ({days} days behind)","Compiled photo log ‚Äî {site}"]}
],
kpis:{tasksThisMonth:423,hoursSaved:67,costSavings:4020,avgResponseTime:"3.2 min",uptime:99.92},
beforeAfter:{before:[{task:"Daily site reports",time:"90 min per site/day",errors:"Inconsistent format"},{task:"Weather delay logging",time:"Often undocumented",errors:"No audit trail"},{task:"Milestone tracking",time:"Weekly manual updates",errors:"Outdated by mid-week"},{task:"Progress photos",time:"Disorganised folders",errors:"Missing documentation"}],
after:[{task:"Daily site reports",time:"Auto-generated",savings:"95% time saved"},{task:"Weather delay logging",time:"Instant logging",savings:"Complete audit trail"},{task:"Milestone tracking",time:"Real-time updates",savings:"Always current"},{task:"Progress photos",time:"Auto-catalogued",savings:"100% documented"}]}
},
{id:"novacrm",name:"NovaCRM",vertical:"SaaS",tier:"Growth",monthlyPrice:4200,logo:"üí°",
tagline:"Customer success platform ‚Äî 20 accounts, 3 CSMs",deployedSince:"2025-12-10",
agents:[
{id:"churn-analyst",name:"Churn Analyst",description:"Monitors customer health scores, predicts churn risk, and triggers retention workflows",status:"active",statusText:"Calculating health scores",icon:"üìâ",tasksCompleted:624,tasksToday:22,avgTaskTime:"1.9 min",hoursSavedMonth:68,uptime:99.96,capacity:65,
taskLog:[{time:"14:30",task:"Flagged churn risk: Cloudnine Studios ‚Äî score dropped to 34"},{time:"14:22",task:"Generated weekly churn risk report ‚Äî 4 accounts at risk"},{time:"14:15",task:"Detected usage decline at Veloce Motors ‚Äî active users down 30%"},{time:"14:08",task:"Calculated health score for Horizon Pharma ‚Äî 95/100"},{time:"14:02",task:"Triggered re-engagement sequence for Urban Harvest Co"},{time:"13:50",task:"Flagged churn risk: Oaktree Consulting ‚Äî score dropped to 38"},{time:"13:42",task:"Detected usage decline at Titanium Fitness ‚Äî active users down 25%"},{time:"13:30",task:"Calculated health score for Redwood Healthcare ‚Äî 91/100"},{time:"13:18",task:"Generated expansion opportunity report ‚Äî Cascade Energy"},{time:"13:05",task:"Calculated health score for Apex Retail Group ‚Äî 88/100"}]},
{id:"onboarding-specialist",name:"Onboarding Specialist",description:"Manages customer onboarding pipelines, tracks milestones, and ensures time-to-value",status:"active",statusText:"Tracking onboarding pipeline",icon:"üöÄ",tasksCompleted:631,tasksToday:18,avgTaskTime:"2.8 min",hoursSavedMonth:72,uptime:99.97,capacity:70,
taskLog:[{time:"14:28",task:"Advanced Cobalt Security to go-live prep stage (90%)"},{time:"14:18",task:"Sent onboarding checklist to Frostbyte Gaming"},{time:"14:05",task:"Completed data import for Starline Media ‚Äî 820 records"},{time:"13:52",task:"Generated onboarding pipeline status report"},{time:"13:40",task:"Scheduled kickoff call with Oaktree Consulting ‚Äî Jake Torres"},{time:"13:28",task:"Advanced Starline Media to training stage (80%)"},{time:"13:15",task:"Flagged blocker: Urban Harvest Co ‚Äî legacy CSV format issues"},{time:"13:02",task:"Sent integration setup guide to Frostbyte Gaming"},{time:"12:48",task:"Completed admin training session for Cobalt Security"},{time:"12:35",task:"Updated onboarding timeline for Oaktree Consulting"}]},
{id:"support-triage",name:"Support Triage",description:"Auto-categorises support tickets, routes to correct teams, and monitors SLA compliance",status:"processing",statusText:"Triaging ticket queue",icon:"üé´",tasksCompleted:621,tasksToday:25,avgTaskTime:"0.8 min",hoursSavedMonth:58,uptime:99.98,capacity:78,
taskLog:[{time:"14:32",task:"Auto-triaged TK-4201: SSO integration ‚Äî routed to Engineering"},{time:"14:25",task:"Escalated TK-4205: Billing discrepancy ‚Äî Titanium Fitness"},{time:"14:18",task:"Resolved TK-4208: Email template help ‚Äî sent documentation"},{time:"14:10",task:"SLA check: TK-4210 ‚Äî 2h SLA, 45m remaining"},{time:"14:02",task:"Categorised 6 new tickets ‚Äî 3 auto-resolved"},{time:"13:48",task:"Auto-triaged TK-4206: API rate limit ‚Äî routed to Tier 2"},{time:"13:35",task:"Resolved TK-4204: Custom webhook ‚Äî sent workaround docs"},{time:"13:22",task:"SLA compliance report: 100% on track"},{time:"13:10",task:"Detected integration ticket pattern ‚Äî 3 this week"},{time:"12:55",task:"Auto-triaged TK-4209: SAML cert renewal ‚Äî routed to Security"}]}
],
activities:[
{agent:"churn-analyst",templates:["Calculated health score for {customer} ‚Äî {score}/100","Flagged churn risk: {customer} (score dropped below 50)","Generated weekly churn risk report","Detected usage decline at {customer}","Triggered re-engagement sequence for {customer}"]},
{agent:"onboarding-specialist",templates:["Advanced {customer} to {stage} stage","Sent onboarding checklist to {customer}","Completed data import for {customer}","Generated onboarding pipeline status report","Scheduled kickoff call with {customer}"]},
{agent:"support-triage",templates:["Auto-triaged ticket: {subject} ‚Äî routed to {team}","Escalated {priority} priority ticket for {customer}","Resolved ticket ‚Äî {category} issue","SLA compliance report: {rate}% on track","Categorised {count} new tickets"]}
],
kpis:{tasksThisMonth:1876,hoursSaved:198,costSavings:11880,avgResponseTime:"1.5 min",uptime:99.97},
beforeAfter:{before:[{task:"Churn prediction",time:"Quarterly spreadsheet review",errors:"60% of churned accounts undetected"},{task:"Customer onboarding",time:"4-6 weeks avg",errors:"35% stall before go-live"},{task:"Support ticket triage",time:"15 min per ticket",errors:"28% mis-routed"},{task:"Health scoring",time:"Manual NPS surveys only",errors:"Reactive, not predictive"}],
after:[{task:"Churn prediction",time:"Real-time health scores",savings:"85% at-risk accounts identified"},{task:"Customer onboarding",time:"3 weeks avg",savings:"45% faster"},{task:"Support ticket triage",time:"< 1 min auto-triage",savings:"93% faster"},{task:"Health scoring",time:"Continuous multi-signal",savings:"Predictive, actionable"}]}
},
{id:"atlas-wealth",name:"Atlas Wealth Advisors",vertical:"Financial Services",tier:"Enterprise",monthlyPrice:14500,logo:"üèõÔ∏è",
tagline:"RIA firm ‚Äî $140M AUM, 2 advisors",deployedSince:"2025-11-20",
agents:[
{id:"compliance-monitor",name:"Compliance Monitor",description:"Monitors SEC/FINRA compliance, tracks regulatory deadlines, and flags violations",status:"active",statusText:"Running compliance checks",icon:"üõ°Ô∏è",tasksCompleted:748,tasksToday:24,avgTaskTime:"3.2 min",hoursSavedMonth:92,uptime:99.99,capacity:60,
taskLog:[{time:"14:30",task:"Completed AML/KYC review ‚Äî Kovalenko account flagged overdue"},{time:"14:22",task:"Reviewed personal trading pre-clearance ‚Äî 8 requests, no violations"},{time:"14:10",task:"Verified Reg BI documentation for Dr. Okonkwo trade"},{time:"13:58",task:"Flagged FINRA 4512 ‚Äî Greenfield Pension signatory update needed"},{time:"13:45",task:"Generated weekly compliance review ‚Äî 2 action items"},{time:"13:32",task:"Completed Code of Ethics annual certification check"},{time:"13:20",task:"Verified access log audit ‚Äî client portal"},{time:"13:08",task:"Reviewed advertising materials ‚Äî 3 pieces approved"},{time:"12:55",task:"Checked cybersecurity incident log ‚Äî no alerts"},{time:"12:40",task:"Updated compliance calendar ‚Äî Q1 deadlines"}]},
{id:"portfolio-reviewer",name:"Portfolio Reviewer",description:"Prepares quarterly reviews, monitors drift, calculates RMDs, and generates performance reports",status:"active",statusText:"Preparing client review",icon:"üìä",tasksCompleted:742,tasksToday:16,avgTaskTime:"5.1 min",hoursSavedMonth:98,uptime:99.95,capacity:75,
taskLog:[{time:"14:28",task:"Completed quarterly review ‚Äî Richardson Family Trust ($4.2M)"},{time:"14:15",task:"Flagged rebalancing needed ‚Äî international equity underweight"},{time:"14:02",task:"Calculated RMD for Barbara Steinfeld ‚Äî $16,154"},{time:"13:48",task:"Prepared client review materials for Steinfeld meeting (Feb 28)"},{time:"13:35",task:"Generated performance attribution ‚Äî Kapoor joint account"},{time:"13:22",task:"Flagged rebalancing needed ‚Äî Westbrook Endowment"},{time:"13:10",task:"Completed quarterly review ‚Äî Chen Family Office ($12.4M)"},{time:"12:55",task:"Tax-loss harvest scan ‚Äî 3 opportunities identified"},{time:"12:40",task:"Updated IPS compliance check ‚Äî Morrison Foundation"},{time:"12:28",task:"Prepared Social Security claiming scenarios ‚Äî Steinfeld"}]},
{id:"filing-coordinator",name:"Filing Coordinator",description:"Tracks SEC/FINRA filing deadlines, prepares drafts, and manages regulatory submissions",status:"processing",statusText:"Preparing Form ADV amendment",icon:"üìã",tasksCompleted:744,tasksToday:12,avgTaskTime:"4.5 min",hoursSavedMonth:77,uptime:99.97,capacity:68,
taskLog:[{time:"14:30",task:"Updated Form ADV Part 1 progress ‚Äî 60% complete"},{time:"14:18",task:"Deadline alert: Schedule 13D due Feb 20 (3 days)"},{time:"14:05",task:"Prepared Form U4 draft for James Park ‚Äî 70% complete"},{time:"13:50",task:"Generated regulatory filing status report"},{time:"13:38",task:"Submitted Form 13F Q4 2025 ‚Äî accepted by EDGAR"},{time:"13:22",task:"Updated Form ADV Part 2B ‚Äî Nakamura brochure supplement"},{time:"13:10",task:"Deadline alert: Form ADV amendment due Mar 31"},{time:"12:55",task:"Prepared Form CRS update checklist"},{time:"12:40",task:"Verified CRD registration for David Nakamura"},{time:"12:28",task:"Filed state registration renewal ‚Äî Oregon"}]}
],
activities:[
{agent:"compliance-monitor",templates:["Completed {check_type} check ‚Äî {regulation}","Flagged overdue compliance review for {client}","Reviewed personal trading pre-clearance ‚Äî no violations","Generated weekly compliance review","Verified Reg BI documentation for {client}"]},
{agent:"portfolio-reviewer",templates:["Completed quarterly portfolio review for {client}","Flagged rebalancing needed ‚Äî {client}","Prepared client review materials for {client}","Calculated RMD for {client}","Generated performance attribution report"]},
{agent:"filing-coordinator",templates:["Updated {form} filing progress","Deadline alert: {form} due {date}","Submitted {form} to SEC EDGAR","Generated regulatory filing status report","Prepared {form} draft for CCO review"]}
],
kpis:{tasksThisMonth:2234,hoursSaved:267,costSavings:32015,avgResponseTime:"3.8 min",uptime:99.97},
beforeAfter:{before:[{task:"Compliance monitoring",time:"Quarterly manual audits",errors:"Items missed between reviews"},{task:"Portfolio reviews",time:"8 hours per client",errors:"Delayed, clients wait weeks"},{task:"Regulatory filings",time:"Spreadsheet deadline tracking",errors:"2 late filings in 2024"},{task:"Client review prep",time:"Full day per meeting",errors:"Inconsistent materials"}],
after:[{task:"Compliance monitoring",time:"Continuous automated checks",savings:"100% coverage, real-time alerts"},{task:"Portfolio reviews",time:"45 min auto-generated",savings:"90% faster"},{task:"Regulatory filings",time:"Automated deadline tracking",savings:"Zero late filings"},{task:"Client review prep",time:"Auto-generated materials",savings:"95% faster"}]}
}
]};

// ‚îÄ‚îÄ API Configuration ‚îÄ‚îÄ
// Change this URL when migrating from Cloudflare tunnel to api.afrexai.com
const API_BASE = 'https://jail-archived-providence-documentary.trycloudflare.com';

// ‚îÄ‚îÄ Live Data ‚îÄ‚îÄ
let liveData = null;
async function fetchLiveData() {
  try {
    // Fetch from backend API
    const [healthRes, companiesRes] = await Promise.all([
      fetch(API_BASE + '/api/health', {signal: AbortSignal.timeout(8000)}),
      fetch(API_BASE + '/api/companies', {signal: AbortSignal.timeout(8000)})
    ]);
    if (!healthRes.ok || !companiesRes.ok) throw new Error('API error');
    const health = await healthRes.json();
    const companiesData = await companiesRes.json();
    // Transform API response into liveData format expected by existing code
    const companies = {};
    for (const co of (companiesData.companies || [])) {
      companies[co.id] = {
        kpis: {
          tasksCompleted: co.kpis?.tasksCompleted || 0,
          hoursSaved: co.kpis?.hoursSaved || 0,
          accuracyRate: co.kpis?.accuracyRate || 0
        },
        agents: (co.agents || []).map(a => ({
          id: a.id, status: a.status || 'active', taskCount: a.taskCount || 0
        })),
        recentActivity: (co.recentActivity || []).map(a => ({
          ts: a.ts, agent: a.agent, action: a.action, type: a.type,
          real: a.real || false, artifact: a.artifact || null
        }))
      };
    }
    liveData = { lastUpdated: health.lastUpdated || new Date().toISOString(), companies };
    updateLiveBadge(true, liveData.lastUpdated);
    return true;
  } catch(e) {
    console.warn('API fetch failed, using simulated data:', e.message);
    // Fallback: try local data/activity.json
    try {
      const r = await fetch('data/activity.json?_=' + Date.now());
      if (r.ok) {
        const d = await r.json();
        const age = Date.now() - new Date(d.lastUpdated).getTime();
        if (age < 7200000) { liveData = d; updateLiveBadge(true, d.lastUpdated); return true; }
      }
    } catch(e2) {}
    liveData = null;
    updateLiveBadge(false);
    return false;
  }
}
function updateLiveBadge(isLive, lastUpdated) {
  let badge = document.getElementById('live-badge');
  if (!badge) return;
  if (isLive) {
    const ago = Math.round((Date.now() - new Date(lastUpdated).getTime()) / 60000);
    badge.innerHTML = 'üü¢ Live Data' + (ago > 0 ? ' <span style="font-size:10px;color:var(--text-muted)">(' + ago + 'm ago)</span>' : '');
    badge.style.color = 'var(--green)';
  } else {
    badge.textContent = 'üî¥ Simulated';
    badge.style.color = 'var(--text-muted)';
  }
}
function applyLiveData() {
  if (!currentCompany) return;
  const companyId = currentCompany.id;
  const live = liveData?.companies?.[companyId];
  if (!live) return;
  // Apply KPIs
  if (live.kpis) {
    const k = live.kpis;
    if (k.tasksCompleted != null) { currentCompany.kpis.tasksThisMonth = k.tasksCompleted; const el = document.getElementById('kpi-tasks'); if (el) el.textContent = fmtNum(k.tasksCompleted); }
    if (k.hoursSaved != null) { currentCompany.kpis.hoursSaved = k.hoursSaved; const el = document.getElementById('kpi-hours'); if (el) el.textContent = fmtNum(Math.round(k.hoursSaved * 10) / 10); }
    if (k.accuracyRate != null) { /* uptime-like */ }
  }
  // Apply agent statuses
  if (live.agents) {
    live.agents.forEach(la => {
      const agent = currentCompany.agents.find(a => a.id === la.id);
      if (!agent) return;
      if (la.status) agent.status = la.status;
      if (la.taskCount != null) { agent.tasksCompleted = la.taskCount; }
      const stEl = document.getElementById('status-text-' + la.id);
      if (stEl && la.status) stEl.textContent = la.status === 'active' ? 'Processing tasks' : la.status;
    });
  }
  // Prepend live activity to feed
  if (live.recentActivity && live.recentActivity.length > 0) {
    const feedEl = document.getElementById('activity-feed');
    if (!feedEl) return;
    const existingLive = feedEl.querySelectorAll('.feed-item-live');
    existingLive.forEach(el => el.remove());
    const liveItems = live.recentActivity.slice(0, 20);
    const frag = document.createDocumentFragment();
    liveItems.forEach(act => {
      const agent = currentCompany.agents.find(a => a.id === act.agent);
      const div = document.createElement('div');
      const isReal = act.real && act.artifact;
      div.className = 'feed-item feed-item-live' + (isReal ? ' feed-item-real' : '');
      div.style.animation = 'none';
      const t = new Date(act.ts);
      const agentIcon = agent ? agent.icon : 'ü§ñ';
      const agentName = agent ? agent.name : act.agent;
      const badge = isReal
        ? '<span class="ai-badge">‚ú¶ AI Generated</span>'
        : '<span style="color:var(--green);font-size:9px">‚óè LIVE</span>';
      const viewLink = isReal
        ? ' <span class="view-output-link" onclick="event.stopPropagation();openArtifactModal(\x27' + agentIcon + '\x27,\x27' + agentName.replace(/'/g,"\\'") + '\x27,\x27' + currentCompany.name.replace(/'/g,"\\'") + '\x27,\x27' + t.toLocaleString().replace(/'/g,"\\'") + '\x27,\x27' + act.artifact + '\x27)">View Output ‚Üí</span>'
        : '';
      div.innerHTML = '<span class="feed-icon">' + agentIcon + '</span><div style="flex:1;min-width:0"><div><span class="feed-agent">' + agentName + '</span> <span class="feed-text">' + act.action + '</span>' + viewLink + '</div><div class="feed-time">' + timeStr(t) + ' ' + badge + '</div></div>';
      frag.appendChild(div);
    });
    feedEl.insertBefore(frag, feedEl.firstChild);
    while (feedEl.children.length > 50) feedEl.removeChild(feedEl.lastChild);
  }
  renderDeliverablesBanner();
}

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
let currentCompany=null;
let simulator=null;
let currentView='dashboard';

// ‚îÄ‚îÄ Render Company Selector ‚îÄ‚îÄ
function renderSelector(){
  document.getElementById('company-cards').innerHTML=DEMO_DATA.companies.map(c=>`
    <div class="company-card" onclick="selectCompany('${c.id}')">
      <div class="cc-icon">${c.logo}</div>
      <div class="cc-name">${c.name}</div>
      <div class="cc-pills">
        <span class="pill pill-vertical">${c.vertical}</span>
        <span class="pill pill-tier">${c.tier}</span>
      </div>
      <div class="cc-agents">${c.agents.length} Agent${c.agents.length>1?'s':''} Deployed</div>
      <div class="cc-tagline">${c.tagline}</div>
      <button class="cc-btn">Explore ‚Üí</button>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ Select Company ‚îÄ‚îÄ
let livePoller = null;
async function selectCompany(id){
  currentCompany=DEMO_DATA.companies.find(c=>c.id===id);
  if(!currentCompany)return;
  if(simulator)simulator.stop();
  if(livePoller){clearInterval(livePoller);livePoller=null;}
  document.getElementById('selector').style.display='none';
  document.getElementById('app').classList.add('visible');
  document.getElementById('hdr-company').textContent=currentCompany.name;
  document.getElementById('hdr-pills').innerHTML=`<span class="pill pill-vertical">${currentCompany.vertical}</span><span class="pill pill-tier">${currentCompany.tier}</span>`;
  await fetchLiveData();
  renderDashboard();
  renderAgentsList();
  renderROI();
  navigateView('dashboard');
  applyLiveData();
  renderDeliverablesBanner();
  simulator=new ActivitySimulator(currentCompany);
  simulator.start();
  livePoller=setInterval(async()=>{await fetchLiveData();applyLiveData();},60000);
}

// ‚îÄ‚îÄ Switch back ‚îÄ‚îÄ
document.getElementById('switch-btn').addEventListener('click',()=>{
  if(simulator)simulator.stop();
  if(livePoller){clearInterval(livePoller);livePoller=null;}
  document.getElementById('app').classList.remove('visible');
  document.getElementById('selector').style.display='flex';
  closeDetail();
});

// ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ
function navigateView(view){
  currentView=view;
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById('view-'+view).classList.add('active');
  document.querySelectorAll('.nav-link[data-view]').forEach(l=>l.classList.toggle('active',l.dataset.view===view));
  document.querySelectorAll('#bottom-nav button').forEach(b=>b.classList.toggle('active',b.dataset.view===view));
}
document.querySelectorAll('.nav-link[data-view],#bottom-nav button[data-view]').forEach(el=>{
  el.addEventListener('click',()=>navigateView(el.dataset.view));
});

// ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ
function renderDashboard(){
  const c=currentCompany,k=c.kpis;
  const weeks=Math.round(k.hoursSaved/40*10)/10;
  document.getElementById('kpi-grid').innerHTML=`
    <div class="metric-card"><div class="value" id="kpi-tasks">${fmtNum(k.tasksThisMonth)}</div><div class="label">Tasks This Month</div></div>
    <div class="metric-card"><div class="value" id="kpi-hours">${fmtNum(k.hoursSaved)}</div><div class="label">Hours Saved</div><div class="sub">‚âà ${weeks} work weeks</div></div>
    <div class="metric-card"><div class="value" id="kpi-savings">${fmt$(k.costSavings)}</div><div class="label">Cost Savings</div><div class="sub">vs manual processing</div></div>
    <div class="metric-card"><div class="value">${k.uptime}%</div><div class="label">Uptime</div><div class="sub"><span class="status-dot active"></span>All systems</div></div>
  `;
  renderAgentGrid();
}

function renderAgentGrid(){
  document.getElementById('agent-grid').innerHTML=currentCompany.agents.map(a=>`
    <div class="card agent-card" onclick="openDetail('${a.id}')">
      <div class="agent-avatar">${a.icon}</div>
      <div class="agent-info">
        <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
          <span class="agent-name">${a.name}</span>
          <span class="status-dot ${a.status}"></span>
          <span style="font-size:12px;color:var(--text-dim)" id="status-text-${a.id}">${a.statusText}</span>
        </div>
        <div class="agent-meta">
          <span>Today: <strong id="today-${a.id}">${a.tasksToday}</strong> tasks</span>
          <span>Avg: <strong>${a.avgTaskTime}</strong></span>
        </div>
      </div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ Agents List View ‚îÄ‚îÄ
function renderAgentsList(){
  document.getElementById('agents-list').innerHTML=currentCompany.agents.map(a=>`
    <div class="card agent-card" onclick="openDetail('${a.id}')" style="flex-direction:column;gap:12px;cursor:pointer">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="agent-avatar">${a.icon}</div>
        <div>
          <div class="agent-name">${a.name}</div>
          <div style="font-size:12px;color:var(--text-dim);margin-top:2px"><span class="status-dot ${a.status}"></span>${a.statusText}</div>
        </div>
      </div>
      <div style="font-size:13px;color:var(--text-dim);line-height:1.5">${a.description}</div>
      <div class="agent-meta">
        <span>Completed: <strong>${fmtNum(a.tasksCompleted)}</strong></span>
        <span>Today: <strong>${a.tasksToday}</strong></span>
        <span>Saved: <strong>${a.hoursSavedMonth}h/mo</strong></span>
        <span>Uptime: <strong>${a.uptime}%</strong></span>
      </div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ ROI View ‚îÄ‚îÄ
function renderROI(){
  const c=currentCompany,k=c.kpis;
  const fte=Math.round(k.hoursSaved/160*10)/10;
  const maxBar=Math.max(k.costSavings,c.monthlyPrice);
  document.getElementById('roi-content').innerHTML=`
    <div class="roi-box">
      <div>
        <div class="roi-label">Monthly Savings</div>
        <div class="roi-value">${fmt$(k.costSavings)}</div>
        <div class="roi-sub">${Math.round(k.costSavings/c.monthlyPrice*10)/10}√ó return on ${fmt$(c.monthlyPrice)}/mo</div>
      </div>
      <div>
        <div class="roi-label">Hours Reclaimed</div>
        <div class="roi-value">${k.hoursSaved}</div>
        <div class="roi-sub">hours per month</div>
      </div>
    </div>
    <div class="fte-note">Equivalent to <strong>${fte} full-time employees</strong> ‚Äî automated tasks running 24/7 with ${k.uptime}% uptime.</div>
    <div class="cost-compare">
      <div class="cost-bar-wrap">
        <div class="cost-bar-label">AfrexAI Investment</div>
        <div class="cost-bar-track"><div class="cost-bar-fill" style="width:${c.monthlyPrice/maxBar*100}%;background:var(--gold)">${fmt$(c.monthlyPrice)}/mo</div></div>
      </div>
      <div class="cost-bar-wrap">
        <div class="cost-bar-label">Value Delivered</div>
        <div class="cost-bar-track"><div class="cost-bar-fill" style="width:${k.costSavings/maxBar*100}%;background:var(--green);color:#000">${fmt$(k.costSavings)}/mo</div></div>
      </div>
    </div>
  `;
  // Before/After
  const ba=c.beforeAfter;
  document.getElementById('ba-content').innerHTML=`<table class="ba-table">
    <thead><tr><th>Task</th><th>Without AfrexAI</th><th>With AfrexAI</th><th>Impact</th></tr></thead>
    <tbody>${ba.before.map((b,i)=>{const a=ba.after[i];return`<tr>
      <td class="ba-task">${b.task}</td>
      <td class="ba-before"><span class="ba-bad">${b.time}</span><br><span style="font-size:11px;color:var(--text-muted)">${b.errors}</span></td>
      <td class="ba-after">${a.time}</td>
      <td class="ba-after"><span class="ba-good">${a.savings}</span></td>
    </tr>`}).join('')}</tbody></table>`;
  // Upgrade CTA for Starter
  document.getElementById('upgrade-content').innerHTML=c.tier==='Starter'?`
    <div class="upgrade-cta">
      <h3>üìà Ready to Scale?</h3>
      <p>${c.name} runs ${c.agents.length} agent on Starter (${fmt$(c.monthlyPrice)}/mo). Upgrading to Growth ($12,000/mo) adds Safety & Compliance Monitor + Project Coordinator.</p>
      <a href="https://calendly.com/cbeckford-afrexai/30min" target="_blank" class="cta-btn">Discuss Upgrade ‚Üí</a>
    </div>
  `:'';
}

// ‚îÄ‚îÄ Agent Detail ‚îÄ‚îÄ
function openDetail(agentId){
  const a=currentCompany.agents.find(x=>x.id===agentId);if(!a)return;
  document.getElementById('detail-body').innerHTML=`
    <div class="detail-header"><span class="da">${a.icon}</span><div><h2>${a.name}</h2><div style="font-size:13px;color:var(--text-dim);margin-top:4px"><span class="status-dot ${a.status}"></span>${a.statusText}</div></div></div>
    <p style="font-size:13px;color:var(--text-dim);margin-bottom:20px;line-height:1.5">${a.description}</p>
    <div class="detail-stats">
      <div class="detail-stat"><div class="ds-val">${fmtNum(a.tasksCompleted)}</div><div class="ds-lbl">Tasks Done</div></div>
      <div class="detail-stat"><div class="ds-val">${a.avgTaskTime}</div><div class="ds-lbl">Avg Time</div></div>
      <div class="detail-stat"><div class="ds-val">${a.hoursSavedMonth}h</div><div class="ds-lbl">Hours Saved/Mo</div></div>
      <div class="detail-stat"><div class="ds-val">${a.uptime}%</div><div class="ds-lbl">Uptime</div></div>
    </div>
    <div style="font-size:12px;color:var(--text-dim);margin-bottom:4px">Capacity Utilisation</div>
    <div class="capacity-bar"><div class="capacity-fill" style="width:${a.capacity}%"></div></div>
    <div style="font-size:11px;color:var(--text-muted);margin-top:4px;text-align:right">${a.capacity}%</div>
    <div style="font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);margin-top:20px;margin-bottom:10px;font-weight:600">Recent Tasks</div>
    <div class="detail-log" id="detail-log-${a.id}">${a.taskLog.map(t=>`<div class="dl-item"><span class="dl-time">${t.time}</span>${t.task}</div>`).join('')}</div>
    <div class="detail-deliverables">
      <div class="dd-title">Deliverables</div>
      ${(()=>{
        const delivs = getAgentDeliverables(a.id);
        if (delivs.length === 0) return '<div class="dd-empty">Agent deliverables will appear here as tasks are completed</div>';
        return delivs.map(d => {
          const ts = d.ts ? new Date(d.ts).toLocaleString() : '';
          return '<div class="dd-item"><span class="dd-text">' + d.action + '</span><span class="dd-time">' + ts + '</span><button class="dd-view" onclick="openArtifactModal(\'' + a.icon + '\',\'' + a.name.replace(/'/g,"\\'") + '\',\'' + currentCompany.name.replace(/'/g,"\\'") + '\',\'' + ts.replace(/'/g,"\\'") + '\',\'' + d.artifact + '\')">View</button></div>';
        }).join('');
      })()}
    </div>
  `;
  document.getElementById('detail-overlay').classList.add('visible');
  document.getElementById('detail-panel').classList.add('visible');
}
function closeDetail(){
  document.getElementById('detail-overlay').classList.remove('visible');
  document.getElementById('detail-panel').classList.remove('visible');
}
document.getElementById('detail-close').addEventListener('click',closeDetail);
document.getElementById('detail-overlay').addEventListener('click',closeDetail);

// ‚îÄ‚îÄ Activity Simulator ‚îÄ‚îÄ
class ActivitySimulator{
  constructor(company){this.company=company;this.feed=[];this.timeout=null;this.statusTimers=[];}
  start(){this.seedHistory();this.scheduleNext();this.startStatusCycling();}
  stop(){clearTimeout(this.timeout);this.statusTimers.forEach(t=>clearInterval(t));this.statusTimers=[];}
  seedHistory(){
    const feedEl=document.getElementById('activity-feed');feedEl.innerHTML='';
    for(let i=14;i>=0;i--){
      const t=new Date(Date.now()-i*120000-Math.random()*60000);
      const item=this.generateItem(t);
      this.feed.push(item);
    }
    this.feed.forEach(item=>{
      feedEl.appendChild(this.createFeedEl(item,false));
    });
  }
  scheduleNext(){
    const delay=liveData?(15000+Math.random()*5000):(3000+Math.random()*5000);
    this.timeout=setTimeout(()=>{
      const item=this.generateItem(new Date());
      this.feed.unshift(item);
      if(this.feed.length>50)this.feed.pop();
      const feedEl=document.getElementById('activity-feed');
      const el=this.createFeedEl(item,true);
      feedEl.insertBefore(el,feedEl.firstChild);
      if(feedEl.children.length>50)feedEl.removeChild(feedEl.lastChild);
      // Update agent tasks today
      const agent=this.company.agents.find(a=>a.id===item.agentId);
      if(agent){
        agent.tasksToday++;
        const todayEl=document.getElementById('today-'+agent.id);
        if(todayEl)todayEl.textContent=agent.tasksToday;
        // Add to task log
        agent.taskLog.unshift({time:item.time,task:item.text});
        if(agent.taskLog.length>20)agent.taskLog.pop();
      }
      // Every 10th: bump KPI
      if(this.feed.length%10===0)this.bumpKPIs();
      this.scheduleNext();
    },delay);
  }
  generateItem(date){
    const actGroup=pick(this.company.activities);
    const template=pick(actGroup.templates);
    const text=fillTemplate(template);
    const agent=this.company.agents.find(a=>a.id===actGroup.agent);
    return{time:timeStr(date),agentId:actGroup.agent,agentName:agent?agent.name:'Agent',agentIcon:agent?agent.icon:'ü§ñ',text};
  }
  createFeedEl(item,animate){
    const div=document.createElement('div');
    div.className='feed-item';
    if(!animate)div.style.animation='none';
    div.innerHTML=`<span class="feed-icon">${item.agentIcon}</span><div style="flex:1;min-width:0"><div><span class="feed-agent">${item.agentName}</span> <span class="feed-text">${item.text}</span></div><div class="feed-time">${item.time}</div></div>`;
    return div;
  }
  bumpKPIs(){
    const k=this.company.kpis;
    k.tasksThisMonth++;k.hoursSaved+=0.1;k.costSavings+=6;
    const te=document.getElementById('kpi-tasks');if(te)animateCounter(te,k.tasksThisMonth-1,k.tasksThisMonth);
    const se=document.getElementById('kpi-savings');if(se)se.textContent=fmt$(Math.round(k.costSavings));
    const he=document.getElementById('kpi-hours');if(he)he.textContent=fmtNum(Math.round(k.hoursSaved*10)/10);
  }
  startStatusCycling(){
    this.company.agents.forEach(a=>{
      const cycle=()=>{
        const r=Math.random();
        if(r<0.7){a.status='active';a.statusText=this.getStatusText(a,'active');}
        else if(r<0.9){a.status='processing';a.statusText=this.getStatusText(a,'processing');}
        else{a.status='idle';a.statusText='Waiting for tasks';}
        const dot=document.querySelector(`#agent-grid .status-dot.active, #agent-grid .status-dot.processing, #agent-grid .status-dot.idle`);
        // Update status text in grid
        const stEl=document.getElementById('status-text-'+a.id);
        if(stEl)stEl.textContent=a.statusText;
      };
      const timer=setInterval(cycle,10000+Math.random()*5000);
      this.statusTimers.push(timer);
    });
  }
  getStatusText(agent,status){
    if(status==='processing')return pick(['Analysing...','Generating report...','Processing batch...','Compiling data...']);
    if(status==='idle')return 'Waiting for tasks';
    const group=this.company.activities.find(g=>g.agent===agent.id);
    if(group)return fillTemplate(pick(group.templates)).substring(0,50);
    return 'Processing task';
  }
}

function animateCounter(el,from,to,duration=600){
  const start=performance.now();
  const fromN=typeof from==='string'?parseInt(from.replace(/[^0-9]/g,'')):from;
  const toN=typeof to==='string'?parseInt(to.replace(/[^0-9]/g,'')):to;
  const step=(now)=>{
    const p=Math.min((now-start)/duration,1);
    el.textContent=fmtNum(Math.floor(fromN+(toN-fromN)*p));
    if(p<1)requestAnimationFrame(step);
  };
  requestAnimationFrame(step);
}

// ‚îÄ‚îÄ Markdown Renderer ‚îÄ‚îÄ
function renderMarkdown(md) {
  if (!md) return '';
  let html = md
    .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^# (.+)$/gm, '<h1>$1</h1>')
    .replace(/^---$/gm, '<hr>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/^- (.+)$/gm, '<li>$1</li>');
  // Wrap consecutive <li> in <ul>
  html = html.replace(/((?:<li>.*<\/li>\n?)+)/g, '<ul>$1</ul>');
  // Paragraphs: split by double newlines, wrap non-tag lines
  html = html.split(/\n{2,}/).map(block => {
    block = block.trim();
    if (!block) return '';
    if (/^<(h[1-3]|ul|ol|hr|li)/.test(block)) return block;
    return '<p>' + block.replace(/\n/g, '<br>') + '</p>';
  }).join('\n');
  return html;
}

// ‚îÄ‚îÄ Artifact Cache & Fetch ‚îÄ‚îÄ
const artifactCache = {};
async function fetchArtifact(path) {
  if (artifactCache[path]) return artifactCache[path];
  // Try API first, then local fallback
  const urls = [
    API_BASE + '/api/deliverables/' + path,
    'data/deliverables/' + path + '?_=' + Date.now()
  ];
  for (const url of urls) {
    try {
      const r = await fetch(url, {signal: AbortSignal.timeout(8000)});
      if (!r.ok) continue;
      const ct = r.headers.get('content-type') || '';
      let text;
      if (ct.includes('application/json')) {
        const json = await r.json();
        text = json.content || JSON.stringify(json, null, 2);
      } else {
        text = await r.text();
      }
      artifactCache[path] = text;
      return text;
    } catch(e) { continue; }
  }
  return null;
}

// ‚îÄ‚îÄ Artifact Modal ‚îÄ‚îÄ
function openArtifactModal(agentIcon, agentName, company, timestamp, artifactPath) {
  const overlay = document.getElementById('artifact-overlay');
  document.getElementById('artifact-icon').textContent = agentIcon || 'ü§ñ';
  document.getElementById('artifact-agent').textContent = agentName;
  document.getElementById('artifact-meta').textContent = (company || '') + (timestamp ? ' ¬∑ ' + timestamp : '');
  document.getElementById('artifact-body').innerHTML = '<div class="artifact-spinner">‚è≥ Loading deliverable...</div>';
  overlay.classList.add('visible');
  fetchArtifact(artifactPath).then(md => {
    const body = document.getElementById('artifact-body');
    if (md) {
      body.innerHTML = renderMarkdown(md);
    } else {
      body.innerHTML = '<p style="color:var(--text-muted);text-align:center;padding:40px">Deliverable not available yet.</p>';
    }
  });
}
function closeArtifactModal() {
  document.getElementById('artifact-overlay').classList.remove('visible');
}
document.getElementById('artifact-close').addEventListener('click', closeArtifactModal);
document.getElementById('artifact-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeArtifactModal();
});

// ‚îÄ‚îÄ Deliverables Banner (Dashboard) ‚îÄ‚îÄ
function renderDeliverablesBanner() {
  if (!liveData || !currentCompany) { document.getElementById('deliverables-banner').style.display = 'none'; return; }
  const companyId = currentCompany.id;
  const live = liveData.companies?.[companyId];
  if (!live || !live.recentActivity) { document.getElementById('deliverables-banner').style.display = 'none'; return; }
  const realItems = live.recentActivity.filter(a => a.real && a.artifact);
  if (realItems.length === 0) { document.getElementById('deliverables-banner').style.display = 'none'; return; }
  const top3 = realItems.slice(0, 3);
  document.getElementById('deliverables-banner').style.display = 'block';
  document.getElementById('deliv-cards').innerHTML = top3.map(item => {
    const agent = currentCompany.agents.find(a => a.id === item.agent);
    const icon = agent ? agent.icon : 'ü§ñ';
    const name = agent ? agent.name : item.agent;
    const ts = item.ts ? new Date(item.ts).toLocaleString() : '';
    return `<div class="deliv-card" onclick="openArtifactModal('${icon}','${name}','${currentCompany.name}','${ts}','${item.artifact}')">
      <div class="dc-top"><span class="dc-icon">${icon}</span><span class="dc-agent">${name}</span></div>
      <div class="dc-title">${item.action}</div>
      <div class="dc-time">${ts}</div>
      <div class="dc-link">Read Full Output ‚Üí</div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ Get deliverables for a specific agent ‚îÄ‚îÄ
function getAgentDeliverables(agentId) {
  if (!liveData || !currentCompany) return [];
  const live = liveData.companies?.[currentCompany.id];
  if (!live || !live.recentActivity) return [];
  return live.recentActivity.filter(a => a.real && a.artifact && a.agent === agentId).slice(0, 5);
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
renderSelector();
</script>
</body>
</html>
