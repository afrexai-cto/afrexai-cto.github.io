# Wave 2: Customer Portal â€” Full Specification

> PIV Phase: **PLAN** | Author: Architect Agent | Date: 2026-02-16

---

## 1. Overview

After a customer pays and agents are deployed, they access a static HTML/JS portal (GitHub Pages compatible) that shows their agents, usage, billing, and health. Data is served via per-customer JSON files regenerated by cron from `customer-portal-data.sh`.

---

## 2. Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    cron (every 15m)    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  aaas-platform/  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  portal/data/        â”‚
â”‚  customers/*/    â”‚   customer-portal-     â”‚  {slug}/dashboard.jsonâ”‚
â”‚  profile.json    â”‚   data.sh generate     â”‚  {slug}/health.json  â”‚
â”‚  agent-manifest  â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  monitoring/     â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚ fetch()
                                                       â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚  portal/         â”‚
                                              â”‚  index.html (SPA)â”‚
                                              â”‚  GitHub Pages    â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Static Hosting Constraint
- No server-side code. All data via pre-generated JSON.
- Auth is client-side token verification (hash comparison).
- JSON files pushed to `portal/data/{slug}/` in the repo, served by GitHub Pages.

---

## 3. Auth Approach

### Token-Based (Client-Side Hash)

1. Each customer has an `api_key` in `profile.json` (generated at onboarding).
2. Portal login accepts the token, hashes it with SHA-256, and compares against a hash stored in the customer's `dashboard.json`.
3. On match: store `{slug, token_hash}` in `sessionStorage`, load customer data from `portal/data/{slug}/`.
4. Logout clears sessionStorage.

**Routing:** Token â†’ slug mapping via a lightweight `portal/data/auth-index.json`:
```json
{
  "token_hashes": {
    "abc123hash...": "meridian-health-partners",
    "def456hash...": "acme-corp"
  }
}
```
Portal fetches this file, finds slug from hash, then loads `portal/data/{slug}/dashboard.json`.

**Security note:** This is obscurity-level auth suitable for read-only dashboards. Data is technically public if someone guesses the slug path. Acceptable for MVP; upgrade path is Cloudflare Workers + JWT.

---

## 4. Pages & Wireframes

The portal is a single `index.html` SPA with hash-based routing (`#login`, `#dashboard`, `#agents`, `#billing`, `#health`, `#settings`).

### 4.1 Login (`#login`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [AfrexAI Logo]          â”‚
â”‚      Agent Status Portal        â”‚
â”‚                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ Enter access code     â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚   [ Sign In ]                   â”‚
â”‚                                 â”‚
â”‚   Invalid access code (hidden)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- Existing design preserved. Only change: login now fetches `auth-index.json` to resolve slug.

### 4.2 Dashboard (`#dashboard`) â€” Default after login

```
â”Œâ”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AfrexAI    {Company Name}    [Nav] [Sign Out] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”             â”‚
â”‚ â”‚  3  â”‚ â”‚ 3/3 â”‚ â”‚$13k â”‚ â”‚Mar 1â”‚             â”‚
â”‚ â”‚Agentsâ”‚ â”‚Activeâ”‚ â”‚/mo  â”‚ â”‚Next â”‚             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ Invoice     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Agent Cards (2-col grid)                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚ğŸ¥ Patient     â”‚ â”‚ğŸ“‹ Compliance â”‚            â”‚
â”‚ â”‚ Coordinator   â”‚ â”‚  Officer     â”‚            â”‚
â”‚ â”‚ â— Active      â”‚ â”‚ â— Active     â”‚            â”‚
â”‚ â”‚ Last: 2m ago  â”‚ â”‚ Last: 5m ago â”‚            â”‚
â”‚ â”‚ Today: 47     â”‚ â”‚ Today: 23    â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚ â”‚ğŸ“Š Records     â”‚                              â”‚
â”‚ â”‚  Analyst      â”‚                              â”‚
â”‚ â”‚ â— Active      â”‚                              â”‚
â”‚ â”‚ Last: 1m ago  â”‚                              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ROI This Month                                â”‚
â”‚ $XX,XXX saved Â· X.XÃ— return                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Activity Feed (last 10 events)                â”‚
â”‚ â— Agent did thing â€” 2m ago                    â”‚
â”‚ â— Agent did thing â€” 18m ago                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Billing (`#billing`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current Plan                                  â”‚
â”‚ Enterprise Â· $13,200/mo Â· 3 agents            â”‚
â”‚ Cycle: Monthly | Next: Mar 1 | Status: Active â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Usage Breakdown                               â”‚
â”‚ Patient Coordinator ................ $4,400    â”‚
â”‚ Compliance Officer ................. $4,400    â”‚
â”‚ Records Analyst .................... $4,400    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚ Total .............................. $13,200   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Invoice History                               â”‚
â”‚ Feb 2026  $13,200  âœ“ Paid                     â”‚
â”‚ (future: from Stripe webhook data)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 Health (`#health`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System Status          [SLA Badge: 99.9%]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Per-Agent Health                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Patient Coordinator                   â”‚     â”‚
â”‚ â”‚ Uptime: 99.95% â”‚ Resp: 240ms â”‚ Err: 0â”‚     â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 30d     â”‚     â”‚
â”‚ â”‚ SLA: âœ… Enterprise (99.9%)            â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Compliance Officer                    â”‚     â”‚
â”‚ â”‚ Uptime: 100% â”‚ Resp: 180ms â”‚ Err: 0  â”‚     â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 30d     â”‚     â”‚
â”‚ â”‚ SLA: âœ… Enterprise (99.9%)            â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚ ...                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Incident Log (empty = good)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 Settings (`#settings`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Company Info (read-only from profile)         â”‚
â”‚ Company: Meridian Health Partners              â”‚
â”‚ Contact: dr.chen@meridianhealth.com           â”‚
â”‚ Vertical: Healthcare â”‚ Tier: Enterprise       â”‚
â”‚ Onboarded: Feb 16, 2026                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Notification Preferences (future)             â”‚
â”‚ â–¡ Email alerts on agent errors                â”‚
â”‚ â–¡ Weekly summary digest                       â”‚
â”‚ â–¡ Invoice notifications                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Support                                       â”‚
â”‚ [Book a Call â†’]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Component List

| Component | Description | Data Source |
|-----------|-------------|-------------|
| `LoginScreen` | Token input, hash verify, slug lookup | `auth-index.json` |
| `NavBar` | Sticky header, company name, page links, sign out | `dashboard.json` |
| `MetricCards` | 4-card grid: agents, active, monthly cost, next invoice | `dashboard.json â†’ summary + billing` |
| `AgentCard` | Name, role/type, status badge, last heartbeat, daily tasks | `dashboard.json â†’ agents[]` |
| `AgentGrid` | Responsive grid of AgentCards | â€” |
| `ROIBox` | Savings total, multiplier, breakdown lines | `dashboard.json â†’ roi` |
| `ActivityFeed` | Chronological event list with dot indicators | `dashboard.json â†’ activity[]` |
| `BillingPlan` | Plan name, price, cycle, next invoice, payment status | `dashboard.json â†’ billing` |
| `UsageBreakdown` | Per-agent cost table | `dashboard.json â†’ agents[] + billing` |
| `InvoiceHistory` | List of past invoices | `dashboard.json â†’ invoices[]` |
| `HealthCard` | Per-agent uptime bar, response time, error count, SLA badge | `health.json â†’ agents[]` |
| `SLABadge` | Tier-appropriate SLA target with pass/fail | `health.json â†’ sla` |
| `IncidentLog` | Chronological list of downtime events | `health.json â†’ incidents[]` |
| `SettingsPanel` | Read-only company info, notification prefs (future) | `dashboard.json` |
| `StatusIndicator` | Colored dot/badge (active/paused/error) | Reusable |
| `UptimeBar` | 30-day visual uptime strip (green/red segments) | `health.json` |

---

## 6. JSON Schemas

### 6.1 `auth-index.json`

```json
{
  "token_hashes": {
    "<sha256_of_api_key>": "<customer_slug>"
  }
}
```

Generated by: `customer-portal-data.sh all` (new `--with-auth` flag).

### 6.2 `dashboard.json` (per customer)

Path: `portal/data/{slug}/dashboard.json`

```json
{
  "customer_slug": "meridian-health-partners",
  "company_name": "Meridian Health Partners",
  "tier": "enterprise",
  "vertical": "healthcare",
  "status": "active",
  "onboarded_at": "2026-02-16T20:30:31Z",
  "generated_at": "2026-02-16T21:00:00Z",
  "contact_email": "dr.chen@meridianhealth.com",
  "period_days": 30,
  "billing": {
    "monthly_price_usd": 13200,
    "billing_cycle": "monthly",
    "next_invoice": "2026-03-01",
    "annual_cost": 158400,
    "payment_method": "Visa â€¢â€¢4291",
    "payment_status": "active"
  },
  "summary": {
    "agent_count": 3,
    "active_agents": 3,
    "paused_agents": 0,
    "error_agents": 0,
    "total_tasks_completed": 1843,
    "hours_saved": 127,
    "cost_saved_usd": 38400,
    "uptime_percent": 99.95,
    "health_status": "healthy",
    "roi_percent": 191
  },
  "roi": {
    "monthly_investment": 13200,
    "monthly_savings": 38400,
    "net_monthly_value": 25200,
    "roi_multiplier": 2.9,
    "breakdown": [
      { "label": "Hours saved", "quantity": 127, "unit_value": 85, "total": 10795 },
      { "label": "Leads generated", "quantity": 89, "unit_value": 210, "total": 18690 },
      { "label": "Emails automated", "quantity": 614, "unit_value": 14.50, "total": 8903 }
    ]
  },
  "agents": [
    {
      "agent_slug": "patient-coordinator",
      "agent_name": "Patient Coordinator",
      "status": "active",
      "icon": "ğŸ¥",
      "role": "Patient scheduling & coordination",
      "tasks_completed": 640,
      "tasks_per_day": 21,
      "avg_task_minutes": 28,
      "success_rate": 97,
      "hours_saved": 45,
      "cost_saved_usd": 12800,
      "last_heartbeat": "2026-02-16T20:58:00Z"
    }
  ],
  "activity": [
    {
      "agent_slug": "patient-coordinator",
      "agent_name": "Patient Coordinator",
      "event": "Processed 12 appointment requests",
      "timestamp": "2026-02-16T20:56:00Z",
      "color": "gold"
    }
  ],
  "invoices": [
    {
      "period": "Feb 2026",
      "amount_usd": 13200,
      "status": "paid",
      "paid_at": "2026-02-01T00:00:00Z",
      "stripe_invoice_id": "inv_xxx"
    }
  ]
}
```

### 6.3 `health.json` (per customer)

Path: `portal/data/{slug}/health.json`

```json
{
  "customer_slug": "meridian-health-partners",
  "generated_at": "2026-02-16T21:00:00Z",
  "overall_uptime_percent": 99.95,
  "overall_status": "healthy",
  "sla": {
    "tier": "enterprise",
    "target_uptime": 99.9,
    "compliant": true
  },
  "agents": [
    {
      "agent_slug": "patient-coordinator",
      "agent_name": "Patient Coordinator",
      "status": "active",
      "uptime_percent": 99.95,
      "avg_response_ms": 240,
      "error_count_30d": 0,
      "last_heartbeat": "2026-02-16T20:58:00Z",
      "sla_compliant": true,
      "uptime_daily": [
        { "date": "2026-02-16", "uptime": 100.0 },
        { "date": "2026-02-15", "uptime": 99.8 }
      ]
    }
  ],
  "incidents": []
}
```

---

## 7. Data Flow

### 7.1 Generation Pipeline

```
cron (*/15 * * * *) â†’ customer-portal-data.sh all --output portal/data/
                    â†’ generates: portal/data/{slug}/dashboard.json  (each customer)
                    â†’ generates: portal/data/auth-index.json        (tokenâ†’slug map)

cron (*/15 * * * *) â†’ sla-health-export.sh all --output portal/data/
                    â†’ generates: portal/data/{slug}/health.json     (each customer)

cron (*/15 * * * *) â†’ git add portal/data/ && git commit && git push
                    â†’ GitHub Pages serves updated JSON
```

### 7.2 Portal Data Loading (Client-Side)

```
1. User enters token
2. fetch('portal/data/auth-index.json')
3. SHA-256(token) â†’ lookup slug
4. Store slug + hash in sessionStorage
5. fetch(`portal/data/${slug}/dashboard.json`)
6. fetch(`portal/data/${slug}/health.json`)
7. Render SPA from JSON
8. Auto-refresh every 5 minutes (re-fetch JSON)
```

### 7.3 Changes to `customer-portal-data.sh`

| Change | Description |
|--------|-------------|
| Add `activity[]` array | Generate simulated/real activity feed events per agent |
| Add `invoices[]` array | Pull from `billing.json` or Stripe export |
| Add `last_heartbeat` per agent | From monitoring data or simulated |
| Add `icon` per agent | Map from agent template to emoji |
| Add `--with-auth` flag | Generate `auth-index.json` from `profile.json â†’ api_key` |
| New script: `sla-health-export.sh` | Parse `sla-monitor.sh` output into `health.json` per customer |
| Add `contact_email` to output | From profile.json |
| Add `active/paused/error` counts to summary | Derive from agent statuses |

---

## 8. Design System

Carried forward from existing `portal/index.html`:

| Token | Value |
|-------|-------|
| `--bg` | `#0a0a0a` |
| `--surface` | `#111` |
| `--surface2` | `#1a1a1a` |
| `--gold` | `#FFD700` |
| `--text` | `#e8e8e8` |
| `--text-dim` | `#888` |
| `--green` | `#00e676` |
| `--red` | `#ff5252` |
| `--orange` | `#ffab40` |
| `--radius` | `12px` |
| Font | System stack (already set) |
| Responsive | Mobile-first, `max-width: 1200px` container |

### Navigation

Tab bar below header: **Dashboard** | **Billing** | **Health** | **Settings**

On mobile: horizontal scroll tabs or hamburger â†’ slide-out.

---

## 9. SLA Tier Targets

| Tier | Uptime Target | Response SLA | Support |
|------|--------------|-------------|---------|
| Starter | 99.0% | 24h | Email |
| Growth | 99.5% | 4h | Email + Chat |
| Enterprise | 99.9% | 1h | Dedicated |

Badge colors: âœ… green if compliant, âš ï¸ orange if within 0.5% of breach, ğŸ”´ red if breached.

---

## 10. Implementation Order

### Phase 1: Data Pipeline (Day 1)
1. Extend `customer-portal-data.sh` with `activity[]`, `invoices[]`, `last_heartbeat`, `icon`, auth index
2. Create `sla-health-export.sh` to generate `health.json`
3. Add cron job for generation + git push
4. Validate JSON output for all existing customers

### Phase 2: Portal SPA Core (Day 2)
1. Refactor `portal/index.html` from hardcoded â†’ JSON-driven
2. Add hash-based router (`#login`, `#dashboard`, `#billing`, `#health`, `#settings`)
3. Implement `auth-index.json` lookup in login flow
4. Build Dashboard page (metrics + agent cards + ROI + activity feed)

### Phase 3: Billing & Health Pages (Day 3)
1. Billing page: plan card, usage breakdown, invoice history
2. Health page: per-agent health cards, uptime bars, SLA badges, incident log
3. Settings page: company info (read-only), support link

### Phase 4: Polish (Day 4)
1. Mobile responsive testing & fixes
2. Auto-refresh (poll JSON every 5 min)
3. Loading states & error handling (JSON fetch failures)
4. Empty states (no agents, no invoices)
5. Transition animations between pages

### Phase 5: Validate (Day 5)
1. Generate data for all customers, verify JSON schema
2. Test login flow for 3+ customers
3. Test on mobile (iOS Safari, Android Chrome)
4. Lighthouse audit (performance, accessibility)
5. Deploy to GitHub Pages, verify live

---

## 11. Out of Scope (Future Waves)

- Server-side auth (Cloudflare Workers + JWT)
- Real-time WebSocket updates
- Customer self-service (pause/resume agents, change plan)
- Notification preferences that actually send emails
- Stripe Customer Portal embed for payment method management
- Multi-user access per customer (team logins)
- PDF invoice download
- Custom branding per customer

---

## 12. File Structure

```
portal/
â”œâ”€â”€ index.html              â† SPA (login + all pages)
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ auth-index.json     â† token_hash â†’ slug mapping
â”‚   â”œâ”€â”€ meridian-health-partners/
â”‚   â”‚   â”œâ”€â”€ dashboard.json
â”‚   â”‚   â””â”€â”€ health.json
â”‚   â”œâ”€â”€ acme-corp/
â”‚   â”‚   â”œâ”€â”€ dashboard.json
â”‚   â”‚   â””â”€â”€ health.json
â”‚   â””â”€â”€ .../
â””â”€â”€ assets/                 â† (if needed: icons, images)
```

---

*Spec complete. Ready for IMPLEMENT phase.*
